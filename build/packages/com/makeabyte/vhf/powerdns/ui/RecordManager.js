if(!window.qxsettings)qxsettings={};if(qxsettings["qx.version"]==undefined)qxsettings["qx.version"]="0.0";if(qxsettings["qx.isSource"]==undefined)qxsettings["qx.isSource"]=false;if(!window.qxvariants)qxvariants={};qx.Class.define("packages.com.makeabyte.vhf.powerdns.ui.RecordManager",{extend:vhf.Main,properties:{WireFrame:{init:vhf.Main.getInstance()},RecManagerWin:{},ZoneObj:{},Table:{},RowData:{init:[]},Callback:{}},construct:function(obj){this.setZoneObj(obj[0]);this.setCallback(obj[1]);this.setRecManagerWin(new qx.ui.window.Window("DNS Recorda Manager","icon/16/"+this.getWireFrame().getAppIcon()));this.getRecManagerWin().set({showMinimize:true,allowMinimize:false,allowMaximize:true});this.getRecManagerWin().setSpace(225,400,5,425);this.getWireFrame()._addToWorkspace(this.getRecManagerWin());this.getRecManagerWin().removeAll();var ico1=new qx.ui.basic.Atom("Add or remove records by using the right click context menu.","icon/32/mimetypes/text-ascii.png");with(ico1){setTop(5);setLeft(5);setIconPosition("left");}var tv1=new qx.ui.pageview.tabview.TabView;tv1.set({left:4,top:40,right:4,bottom:50});var t1=new qx.ui.pageview.tabview.Button("General","icon/16/mimetypes/text-ascii.png");t1.setChecked(true);tv1.getBar().add(t1);var p1=new qx.ui.pageview.tabview.Page(t1);tv1.getPane().add(p1);var cl1=new qx.ui.layout.CanvasLayout;cl1.setTop(0);cl1.setLeft(0);cl1.setWidth("100%");cl1.setHeight("100%");cl1.setBackgroundColor("white");cl1.setPaddingLeft(0);p1.add(cl1);var tableModel=new qx.ui.table.model.Simple();tableModel.setColumns(["Name","Value"]);var custom={tableColumnModel:function(obj){return new qx.ui.table.columnmodel.Resize(obj);}};this.setTable(new qx.ui.table.Table(tableModel,custom));with(this.getTable()){set({left:0,top:0,width:'100%',height:280,border:"inset-thin"});setMetaColumnCounts([1,-1]);getSelectionModel().setSelectionMode(qx.ui.table.selection.Model.MULTIPLE_INTERVAL_SELECTION);}cl1.add(this.getTable());var tcm=this.getTable().getTableColumnModel();var resizeBehavior=tcm.getBehavior();resizeBehavior.setWidth(0,150);resizeBehavior.setMinWidth(0,50);resizeBehavior.setMaxWidth(0,500);resizeBehavior.setWidth(1,250);resizeBehavior.setMinWidth(1,50);resizeBehavior.setMaxWidth(1,500);tableModel.setColumnEditable(1,true);var btnOK=new qx.ui.form.Button("OK","icon/16/actions/dialog-ok.png");btnOK.set({bottom:10,right:10});btnOK.addEventListener("execute",function(e){this.getRecManagerWin().close();},this);cl1.add(this.getTable());this.getRecManagerWin().add(ico1,tv1,btnOK);var lblCopyright=new qx.ui.basic.Label(this.getWireFrame().getCopyright());lblCopyright.set({bottom:15,left:10});this.getRecManagerWin().add(lblCopyright);this.__populate();this.__loadContextMenu();this.getRecManagerWin().open();},members:{__populate:function(){var json='[{ "name" : "dn", "dn" : "'+this.getZoneObj().dn+'"}]';var callback=qx.lang.Function.bind(this.__getRecordsHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","DNS","getRecords",json);},__getRecordsHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex,"RPC Error");this.getWireFrame()._setStatusText("RPC Error!");}if(result){if(this.getRowData().length){this.getRowData().splice(0,this.getRowData().length);this.getTable().getTableModel().setData(this.getRowData());}for(var i=0;i<result.count;i++){if(result[i].indexOf("record")!==-1){var attrib=eval("result."+result[i]);for(var j=0;j<attrib.count;j++)this.getRowData().push([result[i],attrib[j],result]);}}this.getTable().getTableModel().setData(this.getRowData());this.getTable().getTableModel().addEventListener("dataChanged",function(e){this.getWireFrame()._setStatusText("Updating record...");var selectedObjects=this.getTable().getSelectionModel().getSelectedRanges();var values=[];for(var i=0;i<selectedObjects.length;i++){for(var j=0;j<this.getTable().getTableModel().getRowCount();j++)if(this.getTable().getTableModel().getValue(0,j)==this.getTable().getTableModel().getValue(0,selectedObjects[i].minIndex))values.push(this.getTable().getTableModel().getValue(1,j));RecType=[];RecType[0]="ARecord";RecType[1]="MXRecord";RecType[2]="CNAMERecord";RecType[3]="WKSRecord";RecType[4]="PTRRecord";RecType[5]="HINFORecord";RecType[6]="MINFORecord";RecType[7]="TXTRecord";RecType[8]="RPRecord";RecType[9]="AFSDBRecord";RecType[10]="SIGRecord";RecType[11]="KEYRecord";RecType[12]="GPOSRecord";RecType[13]="AAAARecord";RecType[14]="LOCRecord";RecType[15]="NXTRecord";RecType[16]="SRVRecord";RecType[17]="NAPTRRecord";RecType[18]="KXRecord";RecType[19]="CERTRecord";RecType[20]="A6Record";RecType[21]="DNAMERecord";RecType[22]="APLRecord";RecType[23]="DSRecord";RecType[24]="SSHFPRecord";RecType[25]="IPSECKEYRecord";RecType[26]="RRSIGRecord";RecType[27]="NSECRecord";RecType[28]="DNSKEYRecord";RecType[29]="DHCIDRecord";RecType[30]="SPFRecord";var record="";for(var k=0;k<RecType.length;k++){if(RecType[k].toLowerCase().indexOf(this.getTable().getTableModel().getValue(0,selectedObjects[i].minIndex).toLowerCase())!==-1){record=RecType[k];break;}}var json='['+'{ "name" : "dn", "dn" : "'+this.getTable().getTableModel().getValue(2,selectedObjects[i].minIndex).dn+'"},'+'{ "name" : "'+record+'", "'+record+'" : '+this.getWireFrame().arrayToJson(values)+'}'+']';alert(json);var callback=new qx.lang.Function.bind(this.__updateRecordHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","DNS","updateRecord",json);}},this);}},__updateRecordHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._setStatusText("RPC Error!");this.getWireFrame()._showAlertDialog("error",ex,"RPC Error");}if(result){this.getWireFrame()._setStatusText("Ready");}},__loadContextMenu:function(type){var callback=new qx.lang.Function.bind(this.__populate,this);this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.powerdns.ui.contextmenu.RecordManager",Array(this.getTable(),this.getRowData(),callback,this.getZoneObj().dn));},terminate:function(){this.base(arguments);}}});
