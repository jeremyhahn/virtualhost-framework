if(!window.qxsettings)qxsettings={};if(qxsettings["qx.version"]==undefined)qxsettings["qx.version"]="0.0";if(qxsettings["qx.isSource"]==undefined)qxsettings["qx.isSource"]=false;if(!window.qxvariants)qxvariants={};qx.Class.define("packages.com.makeabyte.vhf.apache2.ui.contextmenu.LDAPVHostManager",{extend:vhf.Main,properties:{WireFrame:{init:vhf.Main.getInstance()},Menu:{init:new qx.ui.menu.Menu},Table:{},RowData:{init:[]},Callback:{}},construct:function(obj){this.setTable(obj[0]);this.setRowData(obj[1]);this.setCallback(obj[2]);this.getMenu().addToDocument();var tbl=this.getTable();tbl.setContextMenu(this.getMenu());tbl.addEventListener("contextmenu",function(e){this.flushMenu();this.showContextMenu(e);},this);},members:{flushMenu:function(){this.getMenu().removeAll();},__deleteWebsite:function(args){this.getWireFrame()._setStatusText("Deleting website "+args[0]+"...");var json='['+'{ "name" : "parentDn", "parentDn" : "'+args[0]+'" },'+'{ "name" : "uidNumber", "uidNumber" : "'+this.getWireFrame().getUserAttribs().uidnumber[0]+'" },'+'{ "name" : "serverName", "serverName" : "'+args[1]+'" }'+']';var callback=qx.lang.Function.bind(this.__deleteWebsiteHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","HTTP","deleteSubtree",json);},__deleteWebsiteHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex.toString(),"RPC Error");this.getWireFrame()._setStatusText("RPC Error!");}if(result){this.getCallback()();this.getWireFrame()._setStatusText("Ready");}},showContextMenu:function(ev){var del=new qx.client.Command;del.addEventListener("execute",function(e){var table=e.getData().getParentMenu().getOpener();var selectedObjects=table.getSelectionModel().getSelectedRanges();for(var i=0;i<selectedObjects.length;i++){var parentDn=table.getTableModel().getValue(1,selectedObjects[i].minIndex).dn.replace(table.getTableModel().getValue(1,selectedObjects[i].minIndex).dn.split(",")[0]+",","");var confirmCallback=qx.lang.Function.bind(this.__deleteWebsite,this);this.getWireFrame()._showConfirmDialog("Are you sure you want to delete the website "+table.getTableModel().getValue(0,selectedObjects[i].minIndex)+"?","Website Delete",confirmCallback,Array(parentDn,table.getTableModel().getValue(0,selectedObjects[i].minIndex)));}},this);var add=new qx.client.Command;add.addEventListener("execute",function(e){var table=e.getData().getParentMenu().getOpener();if((this.getWireFrame().getUserAttribs().webquota!=undefined)&&(this.getTable().getTableModel().getRowCount()>=this.getWireFrame().getUserAttribs().webquota[0])){this.getWireFrame()._showAlertDialog("info","You have exceeded your website quota. Please upgrade your account to add more websites.","New Website");return;}var selectedObjects=table.getSelectionModel().getSelectedRanges();var callback=new qx.lang.Function.bind(this.__addWebsiteCallbackHandler,this);this.getWireFrame()._showPromptDialog("Enter the new website domain name.","New Website",callback,"icon/16/places/html-folder.png");},this);this.getMenu().add(new qx.ui.menu.Button("New","icon/16/actions/edit-add.png",add));this.getMenu().add(new qx.ui.menu.Button("Delete","icon/16/actions/edit-delete.png",del));this.getTable().getContextMenu().setLeft(ev.getClientX());this.getTable().getContextMenu().setTop(ev.getClientY());this.getTable().getContextMenu().setOpener(this.getTable());this.getTable().getContextMenu().show();},__addWebsiteCallbackHandler:function(input){this.getWireFrame()._setStatusText("Creating website "+input+"...");var json='['+'{ "name" : "serverName", "serverName" : "'+input+'" },'+'{ "name" : "uidNumber", "uidNumber" : "'+this.getWireFrame().getUserAttribs().uidnumber[0]+'" },'+'{ "name" : "mail", "mail" : "'+this.getWireFrame().getUserAttribs().mail[0]+'" },'+'{ "name" : "associatedName", "associatedName" : "'+this.getWireFrame().getUserAttribs().dn+'" }'+']';var callback=qx.lang.Function.bind(this.__createWebsiteHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","HTTP","addWith",json);},__createWebsiteHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex.toString(),"RPC Error");this.getWireFrame()._setStatusText("RPC Error!");}if(result){this.getCallback()();this.getWireFrame()._setStatusText("Ready");}},terminate:function(){this.base(arguments);}}});
