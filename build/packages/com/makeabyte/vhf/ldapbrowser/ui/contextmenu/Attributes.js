if(!window.qxsettings)qxsettings={};if(qxsettings["qx.version"]==undefined)qxsettings["qx.version"]="0.0";if(qxsettings["qx.isSource"]==undefined)qxsettings["qx.isSource"]=false;if(!window.qxvariants)qxvariants={};qx.Class.define("packages.com.makeabyte.vhf.ldapbrowser.ui.contextmenu.Attributes",{extend:vhf.Main,properties:{WireFrame:{init:vhf.Main.getInstance()},Menu:{init:new qx.ui.menu.Menu},MenuType:{},ObjTable:{},TableRowData:{},Callback:{},MiscObj:{}},construct:function(obj){this.setObjTable(obj[0]);this.setCallback(obj[1]);this.setMiscObj(obj[2]);this.setTableRowData(obj[3]);this.getMenu().addToDocument();var tbl=this.getObjTable();tbl.setContextMenu(this.getMenu());tbl.addEventListener("contextmenu",function(e){this.flushMenu();this.showContextMenu(e);},this);},members:{flushMenu:function(){this.getMenu().removeAll();},loadProperties:function(type,args){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.properties."+type,args);},__deleteAttrib:function(args){this.getWireFrame()._setStatusText("Deleting "+args[0]+" attribute...");var callback=qx.lang.Function.bind(this.__deleteAttribHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","LDAP","deleteAttrib",this.getMiscObj().dn,args[0],args[1]);},__deleteAttribHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex.toString(),"RPC Error");this.getWireFrame()._setStatusText("RPC Error!");}if(result){var attribute=result.attribute;var value=result.value;if(attribute.length&&value.length){var rowCount=this.getObjTable().getTableModel().getRowCount();for(var j=0;j<rowCount;j++){try{if((this.getObjTable().getTableModel().getValue(0,j)==attribute)&&(this.getObjTable().getTableModel().getValue(1,j)==value))this.getObjTable().getTableModel().removeRows(j,1);}catch(e){}}this.getWireFrame()._setStatusText("Ready");}}},showContextMenu:function(ev){var del=new qx.client.Command;del.addEventListener("execute",function(e){var table=e.getData().getParentMenu().getOpener();var selectedObjects=table.getSelectionModel().getSelectedRanges();for(var i=0;i<selectedObjects.length;i++){var confirmCallback=qx.lang.Function.bind(this.__deleteAttrib,this);this.getWireFrame()._showConfirmDialog("Are you sure you want to delete "+table.getTableModel().getValue(0,selectedObjects[i].minIndex)+" with value "+table.getTableModel().getValue(1,selectedObjects[i].minIndex)+"?","LDAP Object Deletion",confirmCallback,Array(table.getTableModel().getValue(0,selectedObjects[i].minIndex),table.getTableModel().getValue(1,selectedObjects[i].minIndex)));}},this);var add=new qx.client.Command;add.addEventListener("execute",function(e){var table=e.getData().getParentMenu().getOpener();var selectedObjects=table.getSelectionModel().getSelectedRanges();this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.properties.NewAttribute",Array(this.getMiscObj().dn,this.getObjTable(),this.getTableRowData()));},this);this.getMenu().add(new qx.ui.menu.Button("New","icon/16/actions/edit-add.png",add));this.getMenu().add(new qx.ui.menu.Button("Delete","icon/16/actions/edit-delete.png",del));this.getObjTable().getContextMenu().setLeft(ev.getClientX());this.getObjTable().getContextMenu().setTop(ev.getClientY());this.getObjTable().getContextMenu().setOpener(this.getObjTable());this.getObjTable().getContextMenu().show();},terminate:function(){this.base(arguments);}}});
