if(!window.qxsettings)qxsettings={};if(qxsettings["qx.version"]==undefined)qxsettings["qx.version"]="0.0";if(qxsettings["qx.isSource"]==undefined)qxsettings["qx.isSource"]=false;if(!window.qxvariants)qxvariants={};qx.Class.define("packages.com.makeabyte.vhf.ldapbrowser.ui.contextmenu.Tree",{extend:vhf.Main,properties:{WireFrame:{init:vhf.Main.getInstance()},Tree:{},BaseDn:{init:""},Menu:{init:new qx.ui.menu.Menu},MenuType:{init:""},ObjectDn:{},TreeCallback:{},TableCallback:{},BtnCut:{init:new qx.ui.menu.Button("Copy","icon/16/actions/edit-copy.png")},BtnPaste:{init:new qx.ui.menu.Button("Paste","icon/16/actions/edit-paste.png")},CutDn:{init:""}},construct:function(obj){this.setTree(obj[0]);this.setTreeCallback(obj[1]);this.setTableCallback(obj[2]);this.setBaseDn(obj[3]);this.main();},members:{main:function(){this.getMenu().addToDocument();var tbl=this.getTree();this.getBtnPaste().setEnabled(false);tbl.setContextMenu(this.getMenu());tbl.addEventListener("contextmenu",function(e){this.flushMenu();var dn=this.getTree().getHierarchy(this.getTree().getSelectedNodes()[0]).reverse().join(",");dn=dn.replace(/<div style='display:none'>/ig,"");dn=dn.replace(/<\/div>/ig,"=");this.setObjectDn(dn);if(dn==this.getBaseDn())this.showRootContextMenu(e);else this.showObjectContextMenu(e);},this);},flushMenu:function(){this.getMenu().removeAll();},loadProperties:function(type,obj){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.properties."+type,obj);},showRootContextMenu:function(ev){var paste=new qx.client.Command;paste.addEventListener("execute",function(e){var pieces=this.getCutDn().split(",");var newDn=pieces[0]+","+this.getObjectDn();var callback=qx.lang.Function.bind(this.__refreshTreeHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","LDAP","moveSubtree",this.getCutDn(),newDn);this.getBtnPaste().setEnabled(false);this.getBtnCut().setEnabled(true);},this);this.setBtnPaste(new qx.ui.menu.Button("Paste","icon/16/actions/edit-copy.png",paste));this.getBtnPaste().setEnabled((this.getBtnCut().getEnabled()==false));this.getMenu().add(this.getBtnPaste());this.getTree().getContextMenu().setLeft(ev.getClientX());this.getTree().getContextMenu().setTop(ev.getClientY());this.getTree().getContextMenu().setOpener(this.getTree());this.getTree().getContextMenu().show();},showObjectContextMenu:function(ev){var cut=new qx.client.Command;cut.addEventListener("execute",function(e){this.setCutDn(this.getObjectDn());this.getBtnPaste().setEnabled(true);this.getBtnCut().setEnabled(false);},this);var refresh=new qx.client.Command;refresh.addEventListener("execute",function(e){this.getWireFrame()._callAsyncRpc(this.getTreeCallback(),"core.rpc.API","invoke","LDAP","getTreeSource",null);},this);var paste=new qx.client.Command;paste.addEventListener("execute",function(e){var pieces=this.getCutDn().split(",");var newDn=pieces[0]+","+this.getObjectDn();var callback=qx.lang.Function.bind(this.__refreshTreeHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","LDAP","moveSubtree",this.getCutDn(),newDn);this.getBtnPaste().setEnabled(false);this.getBtnCut().setEnabled(true);},this);var del=new qx.client.Command;del.addEventListener("execute",function(e){var callback=qx.lang.Function.bind(this.__deleteConfirmationHandler,this);this.getWireFrame()._showConfirmDialog("Are you sure you want to delete this object and all its children?","Delete Confirmation",callback,this.getObjectDn());},this);var rename=new qx.client.Command;rename.addEventListener("execute",function(e){var callback=qx.lang.Function.bind(this.__renameHandler,this);this.getWireFrame()._showPromptDialog("Enter the new name for this directory object.","Rename",callback);},this);var attr=new qx.client.Command;attr.addEventListener("execute",function(e){var callback=qx.lang.Function.bind(this.__getAttribsHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","LDAP","getAttributes",this.getObjectDn());},this);var newZone=new qx.client.Command;newZone.addEventListener("execute",function(e){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewZone",Array(this.getObjectDn(),this.getTableCallback()));},this);var newSudo=new qx.client.Command;newSudo.addEventListener("execute",function(e){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewSudoRole",Array(this.getObjectDn(),this.getTableCallback()));},this);var newOU=new qx.client.Command;newOU.addEventListener("execute",function(e){var callback=new qx.lang.Function.bind(this.__newOrganizationalUnit,this);this.getWireFrame()._showPromptDialog("Type the name of the new organizational unit.","New Organizational Unit",callback,"icon/16/places/folder.png");},this);var newRepo=new qx.client.Command;newRepo.addEventListener("execute",function(e){this.__newRepository();},this);var newUser=new qx.client.Command;newUser.addEventListener("execute",function(e){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewAccount",Array(this.getObjectDn(),this.getTableCallback(),this.getTreeCallback()));},this);var newGrp=new qx.client.Command;newGrp.addEventListener("execute",function(e){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewGroup",Array(this.getObjectDn(),this.getTableCallback(),"posixGroup"));},this);var newMl=new qx.client.Command;newMl.addEventListener("execute",function(e){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewGroup",Array(this.getObjectDn(),this.getTableCallback(),"mailingList"));},this);var newGg=new qx.client.Command;newGg.addEventListener("execute",function(e){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewGroup",Array(this.getObjectDn(),this.getTableCallback(),"groupOfNames"));},this);var newPkg=new qx.client.Command;newPkg.addEventListener("execute",function(e){var args=Array(this.getObjectDn(),this.getTableCallback());this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewPackage",args);},this);var newApacheVHost=new qx.client.Command;newApacheVHost.addEventListener("execute",function(e){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewApacheConfig",Array(this.getObjectDn(),this.getTableCallback()));},this);this.setBtnPaste(new qx.ui.menu.Button("Paste","icon/16/actions/edit-copy.png",paste));this.getBtnPaste().setEnabled((this.getBtnCut().getEnabled()==false));this.getMenu().add(this.getBtnPaste());this.setBtnCut(new qx.ui.menu.Button("Cut","icon/16/actions/edit-cut.png",cut));this.getBtnCut().setEnabled((this.getBtnPaste().getEnabled()==false));this.getMenu().add(this.getBtnCut());this.getMenu().add(new qx.ui.menu.Button("Rename","icon/16/actions/edit.png",rename));this.getMenu().add(new qx.ui.menu.Button("Delete","icon/16/actions/edit-delete.png",del));this.getMenu().add(new qx.ui.menu.Button("Refresh","icon/16/actions/view-refresh.png",refresh));this.getMenu().add(new qx.ui.menu.Separator());var m2=new qx.ui.menu.Menu;var m2_1=new qx.ui.menu.Button("User Account","icon/16/actions/identity.png",newUser);var m2_2=new qx.ui.menu.Button("Security Group","icon/16/apps/system-users.png",newGrp);var m2_3=new qx.ui.menu.Button("Generic Group","icon/16/apps/accessories-notes.png",newGg);var m2_4=new qx.ui.menu.Button("Mailing List","icon/16/actions/mail.png",newMl);var m2_5=new qx.ui.menu.Button("Apache Virtual Host","resource/vhf/icon/apache.png",newApacheVHost);var m2_6=new qx.ui.menu.Button("Sudo Role","icon/16/categories/applications.png",newSudo);var m2_sep1=new qx.ui.menu.Separator();var m2_7=new qx.ui.menu.Button("Package","icon/16/apps/accessories-archiver.png",newPkg);var m2_8=new qx.ui.menu.Button("Respository","icon/16/apps/internet-download-manager.png",newRepo);var m2_sep2=new qx.ui.menu.Separator();var m2_9=new qx.ui.menu.Button("Organizational Unit","icon/16/actions/folder-new.png",newOU);var m2_10=new qx.ui.menu.Button("DNS Zone","icon/16/places/network-server.png",newZone);m2.add(m2_1,m2_2,m2_3,m2_4,m2_5,m2_6,m2_sep1,m2_7,m2_8,m2_sep2,m2_9,m2_10);m2.addToDocument();this.getMenu().add(new qx.ui.menu.Button("New","icon/16/actions/edit-copy.png",null,m2));this.getMenu().add(new qx.ui.menu.Separator());this.getMenu().add(new qx.ui.menu.Button("Attributes","icon/16/actions/system-run.png",attr));this.getTree().getContextMenu().setLeft(ev.getClientX());this.getTree().getContextMenu().setTop(ev.getClientY());this.getTree().getContextMenu().setOpener(this.getTree());this.getTree().getContextMenu().show();},__deleteConfirmationHandler:function(){var callback=qx.lang.Function.bind(this.__refreshTreeHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","LDAP","deleteSubtree",this.getObjectDn());},__renameHandler:function(input){var pieces=this.getObjectDn().split(",");var namePieces=pieces[0].split("=");var newName=namePieces[0]+"="+input;var newDn=this.getObjectDn().replace(this.getObjectDn().split(",")[0],newName);var callback=qx.lang.Function.bind(this.__refreshTreeHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","LDAP","moveSubtree",this.getObjectDn(),newDn);},__refreshTreeHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex.toString(),"RPC Error");this.getWireFrame()._setStatusText("RPC Error!");}if(result)this.getWireFrame()._callAsyncRpc(this.getTreeCallback(),"core.rpc.API","invoke","LDAP","getTreeSource",null);},__getAttribsHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex.toString(),"RPC Error");this.getWireFrame()._setStatusText("RPC Error");}if(result)this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.properties.Attributes",Array(result,this.getTreeCallback()));},__newOrganizationalUnit:function(input){var dn="ou="+input+","+this.getObjectDn();var callback=qx.lang.Function.bind(this.__refreshTreeHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","LDAP","addOrganizationalUnit",dn);},__newRepository:function(){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewRepository",Array(this.getObjectDn(),this.getTableCallback()));},__newPackage:function(){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.NewPackage",Array(this.getObjectDn(),this.getTableCallback()));},terminate:function(){this.base(arguments);}}});
