if(!window.qxsettings)qxsettings={};if(qxsettings["qx.version"]==undefined)qxsettings["qx.version"]="0.0";if(qxsettings["qx.isSource"]==undefined)qxsettings["qx.isSource"]=false;if(!window.qxvariants)qxvariants={};qx.Class.define("packages.com.makeabyte.vhf.ldapbrowser.ui.SetPassword",{extend:vhf.Main,properties:{WireFrame:{init:vhf.Main.getInstance()},PasswordWin:{},ObjectDn:{},Callback:{}},construct:function(obj){this.setObjectDn(obj[0]);this.setCallback(obj[1]);this.setPasswordWin(new qx.ui.window.Window("Set Password","icon/16/"+this.getWireFrame().getAppIcon()));this.getPasswordWin().set({showMinimize:true,allowMinimize:false,allowMaximize:true});this.getPasswordWin().setSpace(200,400,150,200);this.getPasswordWin().removeAll();var at1=new qx.ui.basic.Atom("Please enter and confirm the new password.","icon/32/status/dialog-password.png");at1.setLocation(4,4);var lblPassword=new qx.ui.basic.Atom('Password');lblPassword.setHorizontalChildrenAlign('right');lblPassword.set({top:60,left:30,width:'10%'});var txtPassword=new qx.ui.form.PasswordField();txtPassword.set({top:60,right:30,width:'70%'});var txtTip="Enter the new password.<br><b>Example:</b>$ecr3tP@55w0rd";var tipIcon=new qx.ui.basic.Atom("","icon/16/apps/accessories-tip.png");tipIcon.set({top:60,right:10});var tooltipBtn=new qx.ui.basic.Atom(txtTip);var tt1=new qx.ui.popup.ToolTip(txtTip);tipIcon.setToolTip(tt1);var lblConfirm=new qx.ui.basic.Atom('Confirm');lblConfirm.setHorizontalChildrenAlign('right');lblConfirm.set({top:85,left:30,width:'10%'});var txtConfirm=new qx.ui.form.PasswordField();txtConfirm.set({top:85,right:30,width:'70%'});var txtTip2="Enter the new password again.<br><b>Example:</b>$ecr3tP@55w0rd";var tipIcon2=new qx.ui.basic.Atom("","icon/16/apps/accessories-tip.png");tipIcon2.set({top:85,right:10});var tooltipBtn=new qx.ui.basic.Atom(txtTip2);var tt2=new qx.ui.popup.ToolTip(txtTip2);tipIcon2.setToolTip(tt2);var btnOK=new qx.ui.form.Button("OK","icon/16/actions/dialog-ok.png");var btnCancel=new qx.ui.form.Button("Cancel","icon/16/actions/dialog-cancel.png");btnOK.set({bottom:10,right:10});btnCancel.set({bottom:10,right:60});btnOK.addEventListener("execute",function(e){if(!txtPassword.getValue().length||!txtConfirm.getValue().length){this.getWireFrame()._showAlertDialog("error","Password must not be blank.","Set Password",null);return;}if(txtPassword.getValue()!=txtConfirm.getValue()){this.getWireFrame()._showAlertDialog("error","Passwords must match.","Set Password");return;}this.__setPassword(txtPassword.getValue());},this);btnCancel.addEventListener("execute",function(e){this.getPasswordWin().close();},this);this.getPasswordWin().add(at1,lblPassword,txtPassword,lblConfirm,txtConfirm,tipIcon,tipIcon2,btnOK,btnCancel);var lblCopyright=new qx.ui.basic.Label(this.getWireFrame().getCopyright());lblCopyright.set({bottom:15,left:10});this.getPasswordWin().add(lblCopyright);this.getPasswordWin().open();this.getWireFrame()._addToWorkspace(this.getPasswordWin());},members:{__setPassword:function(password){var json='['+'{ "name" : "dn", "dn" : "'+this.getObjectDn()+'" },'+'{ "name" : "userPassword", "userPassword" : "'+password+'" }'+']';var callback=qx.lang.Function.bind(this.__setPasswordHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","ACCOUNT","setPassword",json);},__setPasswordHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex.toString(),"RPC Error",null);return false;}if(result){var pieces=this.getObjectDn().split(",")[0].split("=");var parentRdn=this.getObjectDn().replace(pieces[0]+"="+pieces[1]+",","");this.getCallback()(parentRdn);this.getWireFrame()._setStatusText("Ready");this.getPasswordWin().close();}},close:function(){this.base(arguments);},terminate:function(){this.base(arguments);}}});
