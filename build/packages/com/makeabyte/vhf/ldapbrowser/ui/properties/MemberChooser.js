if(!window.qxsettings)qxsettings={};if(qxsettings["qx.version"]==undefined)qxsettings["qx.version"]="0.0";if(qxsettings["qx.isSource"]==undefined)qxsettings["qx.isSource"]=false;if(!window.qxvariants)qxvariants={};qx.Class.define("packages.com.makeabyte.vhf.ldapbrowser.ui.properties.MemberChooser",{extend:vhf.Main,properties:{WireFrame:{init:vhf.Main.getInstance()},MemberChooserWin:{},Table:{},TableModel:{},RowData:{init:[]},ParentTable:{},ParentRowData:{init:[]}},construct:function(arrData){this.setParentTable(arrData[0]);this.setParentRowData(arrData[1]);this.setMemberChooserWin(new qx.ui.window.Window("Member Chooser","icon/16/"+this.getWireFrame().getAppIcon()));this.getMemberChooserWin().set({showMinimize:true,allowMinimize:false,allowMaximize:true});this.getMemberChooserWin().setSpace(200,400,0,450);this.getWireFrame()._addToWorkspace(this.getMemberChooserWin());this.getMemberChooserWin().removeAll();var ico1=new qx.ui.basic.Atom("Choose a member by double clicking its name in the list.","icon/32/apps/system-users.png");with(ico1){setTop(5);setLeft(5);setIconPosition("left");}var tv1=new qx.ui.pageview.tabview.TabView;tv1.set({left:4,top:40,right:4,bottom:50});var t1=new qx.ui.pageview.tabview.Button("General","icon/16/mimetypes/text-ascii.png.png");t1.setChecked(true);tv1.getBar().add(t1);var p1=new qx.ui.pageview.tabview.Page(t1);tv1.getPane().add(p1);var cl1=new qx.ui.layout.CanvasLayout;cl1.setTop(0);cl1.setLeft(0);cl1.setWidth("100%");cl1.setHeight("100%");cl1.setBackgroundColor("white");cl1.setPaddingLeft(0);cl1.removeAll();this.setTableModel(new qx.ui.table.model.Simple());this.getTableModel().setColumns(["Member"]);var custom={tableColumnModel:function(obj){return new qx.ui.table.columnmodel.Resize(obj);}};this.setTable(new qx.ui.table.Table(this.getTableModel(),custom));with(this.getTable()){set({left:0,top:0,width:400,height:280,border:"inset-thin"});setMetaColumnCounts([1,-1]);getSelectionModel().setSelectionMode(qx.ui.table.selection.Model.MULTIPLE_INTERVAL_SELECTION);}this.getTable().addEventListener("dblclick",function(e){var selectedObjects=this.getTable().getSelectionModel().getSelectedRanges();for(var i=0;i<selectedObjects.length;i++){this.getTable().getTableModel().getValue(0,selectedObjects[i].minIndex);var bExists=false;for(var j=0;j<this.getParentTable().getTableModel().getRowCount();j++){if(this.getParentTable().getTableModel().getValue(0,j)==this.getTable().getTableModel().getValue(0,selectedObjects[i].minIndex)){this.getWireFrame()._showAlertDialog("error","This object is already a member!","Error Adding Member");bExists=true;break;}}this.getParentRowData().push([this.getTable().getTableModel().getValue(0,selectedObjects[i].minIndex)]);}if(!bExists)this.getParentTable().getTableModel().setData(this.getParentRowData());this.getMemberChooserWin().close();},this);if(this.getRowData().length){this.getRowData().splice(0,this.getRowData().length);this.getTableModel().setData(this.getRowData());}var tcm=this.getTable().getTableColumnModel();var resizeBehavior=tcm.getBehavior();resizeBehavior.setWidth(0,380);resizeBehavior.setMinWidth(0,50);resizeBehavior.setMaxWidth(0,600);p1.add(cl1);cl1.add(this.getTable());this.getMemberChooserWin().add(ico1,tv1);var lblCopyright=new qx.ui.basic.Label(this.getWireFrame().getCopyright());lblCopyright.set({bottom:15,left:10});this.getMemberChooserWin().add(lblCopyright);this.getMemberChooserWin().open();this.__populateMemberTable();},members:{__populateMemberTable:function(){this.getWireFrame()._setStatusText("Getting a list of possible members...");var callback=qx.lang.Function.bind(this.__populateMemberTableHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","LDAP","getMembers",null);},__populateMemberTableHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex.toString(),"RPC Error");this.getWireFrame()._setStatusText("RPC Error!");}if(result){for(var i=0;i<result.count;i++)this.getRowData().push([result[i].dn]);this.getTableModel().setData(this.getRowData());this.getWireFrame()._setStatusText("Ready");}},terminate:function(){this.base(arguments);}}});
