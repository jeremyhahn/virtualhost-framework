if(!window.qxsettings)qxsettings={};if(qxsettings["qx.version"]==undefined)qxsettings["qx.version"]="0.0";if(qxsettings["qx.isSource"]==undefined)qxsettings["qx.isSource"]=false;if(!window.qxvariants)qxvariants={};qx.Class.define("packages.com.makeabyte.vhf.ldapbrowser.ui.properties.Package",{extend:vhf.Main,properties:{WireFrame:{init:vhf.Main.getInstance()},PackagePropWin:{},PackageObj:{},Table:{},TableModel:{},RowData:{init:[]},Callback:{}},construct:function(obj){this.setPackageObj(obj[0]);this.setCallback(obj[1]);this.setPackagePropWin(new qx.ui.window.Window("Package Properties","icon/16/"+this.getAppIcon()));this.getPackagePropWin().set({showMinimize:true,allowMinimize:false,allowMaximize:true});this.getPackagePropWin().setSpace(200,400,0,450);this.getPackagePropWin().removeAll();var ico1=new qx.ui.basic.Atom("Package Properties","icon/32/apps/accessories-archiver.png");with(ico1){setTop(5);setLeft(5);setIconPosition("left");}var tv1=new qx.ui.pageview.tabview.TabView;tv1.set({left:4,top:40,right:4,bottom:50});var t1=new qx.ui.pageview.tabview.Button("General","icon/16/mimetypes/text-ascii.png");t1.setChecked(true);var t2=new qx.ui.pageview.tabview.Button("Members","icon/16/apps/system-users.png");tv1.getBar().add(t1,t2);var p1=new qx.ui.pageview.tabview.Page(t1);var p2=new qx.ui.pageview.tabview.Page(t2);tv1.getPane().add(p1,p2);var cl1=new qx.ui.layout.CanvasLayout;cl1.setTop(0);cl1.setLeft(0);cl1.setWidth("100%");cl1.setHeight("100%");cl1.setBackgroundColor("white");cl1.setPaddingLeft(0);var lblName=new qx.ui.basic.Atom("Package Name");lblName.setHorizontalChildrenAlign("right");lblName.set({top:30,left:10});var txtName=new qx.ui.form.TextField();txtName.set({top:30,right:30,width:'60%',value:this.getPackageObj().cn[0]});var txtTip1="This is the friendly name which is displayed in reference to this package.<br><b>Example: </b>my_custom_package";var tipIcon1=new qx.ui.basic.Atom("","icon/16/apps/accessories-tip.png");tipIcon1.set({top:30,right:10});var tooltipBtn1=new qx.ui.basic.Atom(txtTip1);var tt1=new qx.ui.popup.ToolTip(txtTip1);tipIcon1.setToolTip(tt1);var lblStatus=new qx.ui.basic.Atom("Status");lblStatus.setHorizontalChildrenAlign("right");lblStatus.set({top:55,left:10});var chkStatus=new qx.ui.form.CheckBox("Enabled");chkStatus.set({top:55,right:185});chkStatus.setChecked((this.getPackageObj().packagestatus[0]=="active"));var txtTip2="Check to enable the package or uncheck to disable this package.";var tipIcon2=new qx.ui.basic.Atom("","icon/16/apps/accessories-tip.png");tipIcon2.set({top:55,right:10});var tooltipBtn2=new qx.ui.basic.Atom(txtTip2);var tt2=new qx.ui.popup.ToolTip(txtTip2);tipIcon2.setToolTip(tt2);var lblClasspath=new qx.ui.basic.Atom("Classpath");lblClasspath.setHorizontalChildrenAlign("right");lblClasspath.set({top:80,left:10});var txtClasspath=new qx.ui.form.TextField();txtClasspath.set({top:80,right:30,width:'60%',value:this.getPackageObj().packageclasspath[0]});var txtTip3="The classpath of the main class in this package.<br><b>Example: </b>packages.my.custom.Package";var tipIcon3=new qx.ui.basic.Atom("","icon/16/apps/accessories-tip.png");tipIcon3.set({top:80,right:10});var tooltipBtn3=new qx.ui.basic.Atom(txtTip3);var tt3=new qx.ui.popup.ToolTip(txtTip3);tipIcon3.setToolTip(tt3);var lblVersion=new qx.ui.basic.Atom("Version");lblVersion.setHorizontalChildrenAlign("right");lblVersion.set({top:105,left:10});var txtVersion=new qx.ui.form.TextField();txtVersion.set({top:105,right:30,width:'60%',value:this.getPackageObj().packageversion[0]});var txtTip4="The version number for this package (recommended major.minor[.revision[.build]].<br><b>Example: </b>1.0";var tipIcon4=new qx.ui.basic.Atom("","icon/16/apps/accessories-tip.png");tipIcon4.set({top:105,right:10});var tooltipBtn4=new qx.ui.basic.Atom(txtTip4);var tt4=new qx.ui.popup.ToolTip(txtTip4);tipIcon4.setToolTip(tt4);this.setTableModel(new qx.ui.table.model.Simple());this.getTableModel().setColumns(["Distinguished Name"]);var custom={tableColumnModel:function(obj){return new qx.ui.table.columnmodel.Resize(obj);}};this.setTable(new qx.ui.table.Table(this.getTableModel(),custom));with(this.getTable()){set({left:0,top:0,width:'99%',height:280,border:"inset-thin"});setMetaColumnCounts([1,-1]);getSelectionModel().setSelectionMode(qx.ui.table.selection.Model.MULTIPLE_INTERVAL_SELECTION);}p2.add(this.getTable());var tcm=this.getTable().getTableColumnModel();var resizeBehavior=tcm.getBehavior();resizeBehavior.setWidth(0,340);resizeBehavior.setMinWidth(0,50);resizeBehavior.setMaxWidth(0,600);this.getRowData().splice(0,this.getRowData().length);this.getTableModel().setData(this.getRowData());var btnCancel=new qx.ui.form.Button("Cancel","icon/16/actions/dialog-cancel.png");btnCancel.addEventListener("execute",function(e){this.getPackagePropWin().close();ico1.setLabel("");},this);btnCancel.set({bottom:10,right:65});var btnOK=new qx.ui.form.Button("OK","icon/16/actions/dialog-ok.png");btnOK.addEventListener("execute",function(e){var members=[];for(var i=0;i<this.getRowData().length;i++)members.push(this.getRowData()[i][0]);var status;(chkStatus.isChecked()==true)?status="active":status="disabled";this.__modifyPackage(status,txtClasspath.getValue(),txtVersion.getValue(),members);this.__renamePackage(txtName.getValue());ico1.setLabel("");},this);btnOK.set({bottom:10,right:10});p1.add(cl1);cl1.add(lblName,txtName,tipIcon1);cl1.add(lblStatus,chkStatus,tipIcon2);cl1.add(lblVersion,txtVersion,tipIcon3);cl1.add(lblClasspath,txtClasspath,tipIcon4);this.getPackagePropWin().add(btnOK,btnCancel);this.getPackagePropWin().add(ico1,tv1);var lblCopyright=new qx.ui.basic.Label(this.getWireFrame().getCopyright());lblCopyright.set({bottom:15,left:10});this.getPackagePropWin().add(lblCopyright);this.getPackagePropWin().open();this.getWireFrame()._addToWorkspace(this.getPackagePropWin());for(var i=0;i<this.getPackageObj().member.count;i++)this.getRowData().push([this.getPackageObj().member[i]]);this.getTableModel().setData(this.getRowData());this.__loadContextMenu("AddRemoveMember",Array(this.getTable(),this.getRowData(),this.getPackageObj().dn));},members:{__modifyPackage:function(status,classpath,version,members){this.getWireFrame()._setStatusText("Updating package attributes...");var json='['+'{ "name" : "dn", "dn" : "'+this.getPackageObj().dn+'"},'+'{ "name" : "packageStatus", "packageStatus" : "'+status+'"},'+'{ "name" : "packageClasspath", "packageClasspath" : "'+classpath+'"},'+'{ "name" : "packageVersion", "packageVersion" : "'+version+'"},'+'{ "name" : "members", "members" :'+this.getWireFrame().arrayToJson(members)+'}'+']';var callback=qx.lang.Function.bind(this.__modifyPackageHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.API","invoke","PACKAGE","update",json);},__renamePackage:function(name){this.getWireFrame()._setStatusText("Renaming package...");var newParent=this.getPackageObj().dn.replace("cn="+this.getPackageObj().cn[0]+",","");var json='['+'{ "name" : "dn", "dn" : "'+this.getPackageObj().dn+'"},'+'{ "name" : "cn", "cn" : "'+name+'"},'+'{ "name" : "parentDn", "parentDn" : "'+newParent+'"}'+']';var callback=qx.lang.Function.bind(this.__renamePackageHandler,this);this.getWireFrame()._callAsyncRpc(callback,"core.rpc.api","invoke","PACKAGE","rename",this.getPackageObj().dn,name,newParent);},__renamePackageHandler:function(result,ex,id){this.getPackagePropWin().close();this.getWireFrame()._setStatusText("Ready");},__modifyPackageHandler:function(result,ex,id){if(ex!=null){this.getWireFrame()._showAlertDialog("error",ex.toString(),"RPC Error");this.getWireFrame()._setStatusText("RPC Error!");}if(result){var parentDn=this.getPackageObj().dn.replace("cn="+this.getPackageObj().cn[0]+",","");this.getCallback()(parentDn);this.getWireFrame()._setStatusText("Ready");}},__loadContextMenu:function(type,obj){this.getWireFrame()._loadPackage("packages.com.makeabyte.vhf.ldapbrowser.ui.contextmenu."+type,obj);},terminate:function(){this.base(arguments);}}});
