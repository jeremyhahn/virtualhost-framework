if(!window.qxsettings)qxsettings={};if(qxsettings["qx.version"]==undefined)qxsettings["qx.version"]="0.0";if(qxsettings["qx.isSource"]==undefined)qxsettings["qx.isSource"]=false;if(!window.qxvariants)qxvariants={};qx.Class.define("packages.core.ui.window.NewRepository",{extend:vhf.Main,properties:{Parent:{init:vhf.Main.getInstance()},NewRepositoryWin:{init:new qx.ui.window.Window("New Repository","icon/16/devices/drive-optical.png")},RepoName:{init:null},RepoUrl:{init:null},RepLv:{init:null},RepLd:{init:null}},construct:function(arrArgs){this.setRepLv(arrArgs[0]);this.setRepLd(arrArgs[1]);this.main();},members:{main:function(){this.getNewRepositoryWin().set({showMinimize:true,allowMinimize:false,allowMaximize:true});this.getNewRepositoryWin().setSpace(200,400,150,200);this.getParent()._addToWorkspace(this.getNewRepositoryWin());var at1=new qx.ui.basic.Atom("Enter the name and URL of the repository.","icon/22/devices/drive-optical.png");at1.setLocation(4,4);var txtNameLabel=new qx.ui.basic.Atom('Name');txtNameLabel.setHorizontalChildrenAlign('right');txtNameLabel.set({top:60,left:30,width:'10%'});var txtName=new qx.ui.form.TextField();txtName.set({top:60,right:30,width:'70%'});var txtTip="The name of the repository.<br><b>Example:</b> Private Intranet";var tipIcon=new qx.ui.basic.Atom("","icon/16/apps/accessories-tip.png");tipIcon.set({top:60,right:10});var tooltipBtn=new qx.ui.basic.Atom(txtTip);var tt1=new qx.ui.popup.ToolTip(txtTip);tipIcon.setToolTip(tt1);var txtUrlLabel=new qx.ui.basic.Atom('URL');txtUrlLabel.setHorizontalChildrenAlign('right');txtUrlLabel.set({top:85,left:30,width:'10%'});var txtURL=new qx.ui.form.TextField();txtURL.set({top:85,right:30,width:'70%',value:'http://'});var txtTip2="The URL of the repository.<br><b>Example:</b> http://vhf.local/repo";var tipIcon2=new qx.ui.basic.Atom("","icon/16/apps/accessories-tip.png");tipIcon2.set({top:85,right:10});var tooltipBtn=new qx.ui.basic.Atom(txtTip2);var tt2=new qx.ui.popup.ToolTip(txtTip2);tipIcon2.setToolTip(tt2);var btnOK=new qx.ui.form.Button("OK","icon/16/actions/dialog-ok.png");var btnCancel=new qx.ui.form.Button("Cancel","icon/16/actions/dialog-cancel.png");btnOK.set({bottom:10,right:10});btnCancel.set({bottom:10,right:60});btnOK.addEventListener("execute",function(e){if(!txtName.getValue().length||!txtURL.getValue().length){this.getParent()._showAlertDialog("error","Please enter both a name and URL for the new repository.","Repository Error",null);}else{this.setRepoName(txtName.getValue());this.setRepoUrl(txtURL.getValue());this.__installRepository(txtName.getValue(),txtURL.getValue());}},this);btnCancel.addEventListener("execute",function(e){this.getNewRepositoryWin().close();},this);this.getNewRepositoryWin().add(at1,txtUrlLabel,txtURL,tipIcon,txtNameLabel,txtName,tipIcon2,btnOK,btnCancel);this.getNewRepositoryWin().open();},__installRepository:function(name,url){this.getParent()._callAsyncRpc(qx.lang.Function.bind(this.__installRepositoryHandler,this),"core.rpc.ui.Packages","installRepository",name,url);},__installRepositoryHandler:function(result,ex,id){if(ex!=null){this.getParent()._showAlertDialog("error",ex.toString(),"RPC Error",null);return false;}if(result){this.getRepLd().push({Name:{text:this.getRepoName()},URL:{text:this.getRepoUrl()}});this.getRepLv().updateSort();this.getRepLv().update();this.getNewRepositoryWin().close();}},close:function(){this.base(arguments);},terminate:function(){this.base(arguments);}}});
